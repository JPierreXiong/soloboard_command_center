# Digital Heirloom 管理员界面快速参考

## 🎯 核心原则

**异常管理**：只关注需要人工介入的 1% 异常情况，其余 99% 由系统自动化运行

---

## 📋 管理员工作流程

### 每日检查（5-10 分钟）

1. **查看高风险预警**：`/admin/digital-heirloom`（看板首页）
2. **处理紧急情况**：剩余时间 < 24 小时的金库
3. **检查系统健康度**：邮件发送量、存储使用量

### 每周计划

| 日期 | 工作重点 | 时间 |
|------|----------|------|
| **周一** | 系统审计：检查上周 TRIGGERED 案例 | 1-2h |
| **周二** | 用户关怀：处理高风险用户 | 1-2h |
| **周三** | 成本评估：分析资源消耗 | 1h |
| **周四** | 补偿回顾：审核补偿日志 | 1h |
| **周五** | 安全巡检：检查异常访问 | 1h |

---

## 🚨 高风险金库处理流程

### 判断标准

- **红色警示**：剩余时间 < 24 小时
- **黄色警示**：剩余时间 < 48 小时
- **优先级**：Pro > Base > Free

### 操作步骤

1. **查看详情**：点击用户邮箱或 Vault ID
2. **判断原因**：
   - 用户忘记签到 → 发送提醒邮件
   - 系统 Bug → 补偿 +30 天
   - 用户投诉 → 补偿 + 记录原因
3. **执行操作**：
   - 点击 `+30 Days` 延长订阅
   - 点击 `Reset Decrypt` 重置解密次数
   - 点击 `Pause` 暂停（紧急情况）

---

## 💰 成本控制检查点

### 邮件成本

- **每日阈值**：500 封
- **警告阈值**：400 封（80%）
- **严重阈值**：450 封（90%）

**处理方式**：
- 超过阈值时，检查是否有异常发送
- 考虑调整 Free 用户的提醒频率

### 存储成本

- **警告阈值**：90% 使用率

**处理方式**：
- 检查是否有异常大的文件
- 考虑清理长期未活跃的 Free 用户数据

### 物流成本（Pro 用户）

- **每日阈值**：10 单

**处理方式**：
- 检查地址验证是否正常
- 减少退回率

---

## 🔐 权限说明

| 角色 | 权限 | 可执行操作 |
|------|------|------------|
| **ReadOnly Admin** | `admin.digital-heirloom.read` | 仅查看报表和统计 |
| **Support Admin** | `admin.digital-heirloom.read` + `admin.digital-heirloom.compensate` | 查看 + 补偿操作 |
| **Super Admin** | `admin.digital-heirloom.*` | 所有操作，包括批量操作 |

---

## 📊 关键指标

### 看板首页显示

- **高风险金库数量**：需要立即关注
- **活跃金库数量**：系统健康度指标
- **今日触发数量**：Dead Man's Switch 触发情况
- **邮件发送统计**：成本控制指标

### 成本监控显示

- **邮件发送量**：今日/本周/本月
- **存储使用量**：总存储/平均每用户
- **物流订单数**：Pro 用户订单统计

---

## 🛠️ 常用操作

### 补偿操作

1. 找到目标金库（搜索邮箱或 Vault ID）
2. 点击操作按钮（+30 Days / Reset Decrypt）
3. 填写补偿原因（必填）
4. 确认操作

### 查看审计日志

1. 访问 `/admin/digital-heirloom/compensations`
2. 筛选条件（管理员/时间范围/操作类型）
3. 查看操作详情和前后状态对比

### 导出数据

1. 访问 `/admin/digital-heirloom/vaults`
2. 设置筛选条件
3. 点击"导出 CSV"（Super Admin）

---

## ⚠️ 报警处理

### 邮件发送量报警

**触发条件**：单日 > 500 封

**处理步骤**：
1. 检查是否有异常发送（系统 Bug）
2. 查看邮件发送日志
3. 如果正常，考虑调整阈值

### 存储使用量报警

**触发条件**：使用率 > 90%

**处理步骤**：
1. 检查是否有异常大的文件
2. 查看存储分布（按计划等级）
3. 考虑清理策略

### 异常触发报警

**触发条件**：单日 TRIGGERED > 50 个

**处理步骤**：
1. **立即暂停 Cron Job**（防止误触发）
2. 检查代码是否有 Bug
3. 通知 Super Admin
4. 修复后恢复 Cron Job

---

## 📚 相关文档

- [完整设计方案](./ADMIN_DASHBOARD_DESIGN.md)
- [实现细节](./ADMIN_DASHBOARD_IMPLEMENTATION.md)
- [API 路由文档](./API_ROUTES_DIGITAL_HEIRLOOM.md)

---

## 🆘 常见问题

### Q: 如何判断是否需要人工干预？

**A**: 
- 系统自动化的：状态流转、邮件发送、Token 生成
- 需要人工的：用户投诉补偿、异常情况处理、批量操作

### Q: 补偿操作会影响审计日志吗？

**A**: 是的，所有补偿操作都会自动记录到审计日志，包括操作人、时间、原因、前后状态。

### Q: 如何防止误操作？

**A**: 
- 所有操作都需要确认对话框
- 敏感操作（批量操作）需要 Super Admin 权限
- 操作前显示当前状态预览

---

**最后更新**: 管理员界面设计方案已创建 ✅
